<?php

use muh\accounting\Services\JournalService;

// نفترض أن معرفات الحسابات كالتالي:
// - حساب النقدية (أو الحساب البنكي): account_id = 801
// - حساب خصم البائع (مصاريف خصم البائع): account_id = 910
// - حساب مستحقات المحاضر: account_id = 310
// - حساب مبيعات الدورة الرقمية (قبل الخصم): account_id = 320
// - حساب خصم مبيعات (حساب معارض للمبيعات) لتثبيت الخصم: account_id = 330
//
// تفاصيل العملية:
// - سعر الدورة الرقمية = 250 دينار
// - قيمة المحاضر = 150 دينار
// - قيمة حصة البائع قبل الخصم = 250 - 150 = 100 دينار
// - خصم البائع بنسبة 10% على حصته = 10 دينار
//   أي أن صافي إيرادات البائع = 100 - 10 = 90 دينار
//
// لجعل القيد متوازنًا، يجب أن يكون مجموع المدينين = مجموع الدائنين.
// هنا نقوم بتسجيل قيد واحد يجمع كل التفاصيل على النحو التالي:
//
// الجانب المدين:
//   1. حساب النقدية (801): 250 دينار (المبلغ الذي استلمه العميل)
//   2. حساب مصروف خصم البائع (910): 10 دينار
//      (هذا المصروف يسجل كتكلفة إضافية تؤثر على صافي إيرادات البائع)
//
// مجموع المدين = 250 + 10 = 260 دينار
//
// الجانب الدائن:
//   1. حساب مستحقات المحاضر (310): 150 دينار
//   2. حساب مبيعات الدورة الرقمية (320): 100 دينار (المبيعات الإجمالية للبائع قبل الخصم)
//   3. حساب خصم مبيعات (330): 10 دينار (يُسجل كحساب معارض للمبيعات)
//      بحيث تكون صافي إيرادات البائع = 100 - 10 = 90 دينار
//
// مجموع الدائن = 150 + 100 + 10 = 260 دينار

$journalService = new JournalService();

$entryDate = date('Y-m-d');
$description = "بيع دورة رقمية بقيمة 250 دينار، مع محاضر 150 دينار، وخصم بائع بنسبة 10% (10 دينار)";

// تفاصيل الجانب المدين
$debitDetails = [
    ['account_id' => 801, 'amount' => 250], // زيادة في النقدية/البنك
    ['account_id' => 910, 'amount' => 10],  // مصروف خصم البائع
];

// تفاصيل الجانب الدائن
$creditDetails = [
    ['account_id' => 310, 'amount' => 150], // مستحقات المحاضر
    ['account_id' => 320, 'amount' => 100], // مبيعات الدورة الرقمية (حصّة البائع قبل الخصم)
    ['account_id' => 330, 'amount' => 10],  // خصم مبيعات (يخفض إيرادات البائع)
];

try {
    $journalEntry = $journalService->createMultiAccountEntry($entryDate, $description, $debitDetails, $creditDetails);
    echo "تم إنشاء القيد المحاسبي لبيع الدورة الرقمية بنجاح، رقم القيد: " . $journalEntry->id;
} catch (\Exception $e) {
    echo "حدث خطأ أثناء إنشاء القيد المحاسبي: " . $e->getMessage();
}

/*
```php
<?php

use muh\accounting\Services\JournalService;

// نفترض أن معرفات الحسابات كالتالي:
// - حساب النقدية (أو الحساب البنكي): account_id = 801
// - حساب خصم البائع (مصاريف خصم البائع): account_id = 910
// - حساب مستحقات المحاضر: account_id = 310
// - حساب مبيعات الدورة الرقمية (قبل الخصم): account_id = 320
// - حساب خصم مبيعات (حساب معارض للمبيعات) لتثبيت الخصم: account_id = 330
//
// تفاصيل العملية:
// - سعر الدورة الرقمية = 250 دينار
// - قيمة المحاضر = 150 دينار
// - قيمة حصة البائع قبل الخصم = 250 - 150 = 100 دينار
// - خصم البائع بنسبة 10% على حصته = 10 دينار
//   أي أن صافي إيرادات البائع = 100 - 10 = 90 دينار
//
// لجعل القيد متوازنًا، يجب أن يكون مجموع المدينين = مجموع الدائنين.
// هنا نقوم بتسجيل قيد واحد يجمع كل التفاصيل على النحو التالي:
//
// الجانب المدين:
//   1. حساب النقدية (801): 250 دينار (المبلغ الذي استلمه العميل)
//   2. حساب مصروف خصم البائع (910): 10 دينار
//      (هذا المصروف يسجل كتكلفة إضافية تؤثر على صافي إيرادات البائع)
//
// مجموع المدين = 250 + 10 = 260 دينار
//
// الجانب الدائن:
//   1. حساب مستحقات المحاضر (310): 150 دينار
//   2. حساب مبيعات الدورة الرقمية (320): 100 دينار (المبيعات الإجمالية للبائع قبل الخصم)
//   3. حساب خصم مبيعات (330): 10 دينار (يُسجل كحساب معارض للمبيعات)
//      بحيث تكون صافي إيرادات البائع = 100 - 10 = 90 دينار
//
// مجموع الدائن = 150 + 100 + 10 = 260 دينار

$journalService = new JournalService();

$entryDate = date('Y-m-d');
$description = "بيع دورة رقمية بقيمة 250 دينار، مع محاضر 150 دينار، وخصم بائع بنسبة 10% (10 دينار)";

// تفاصيل الجانب المدين
$debitDetails = [
    ['account_id' => 801, 'amount' => 250], // زيادة في النقدية/البنك
    ['account_id' => 910, 'amount' => 10],  // مصروف خصم البائع
];

// تفاصيل الجانب الدائن
$creditDetails = [
    ['account_id' => 310, 'amount' => 150], // مستحقات المحاضر
    ['account_id' => 320, 'amount' => 100], // مبيعات الدورة الرقمية (حصّة البائع قبل الخصم)
    ['account_id' => 330, 'amount' => 10],  // خصم مبيعات (يخفض إيرادات البائع)
];

try {
    $journalEntry = $journalService->createMultiAccountEntry($entryDate, $description, $debitDetails, $creditDetails);
    echo "تم إنشاء القيد المحاسبي لبيع الدورة الرقمية بنجاح، رقم القيد: " . $journalEntry->id;
} catch (\Exception $e) {
    echo "حدث خطأ أثناء إنشاء القيد المحاسبي: " . $e->getMessage();
}
```

### شرح المثال:
1. **تفاصيل البيع:**
   - قيمة الدورة الرقمية 250 دينار.
   - يتم احتساب قيمة المحاضر 150 دينار.
   - حصة البائع قبل الخصم = 250 - 150 = 100 دينار.
   - خصم البائع بنسبة 10% من حصته = 10 دينار، فيصبح صافي إيراد البائع 90 دينار.

2. **تفاصيل القيد:**
   - **المدين:**
     - حساب النقدية (801) يسجل 250 دينار.
     - حساب مصروف خصم البائع (910) يسجل 10 دينار.
     - مجموع المدين = 260 دينار.
   - **الدائن:**
     - حساب مستحقات المحاضر (310) يسجل 150 دينار.
     - حساب مبيعات الدورة الرقمية (320) يسجل 100 دينار.
     - حساب خصم المبيعات (330) يسجل 10 دينار.
     - مجموع الدائن = 260 دينار.

3. **التنفيذ:**
   - يتم استخدام دالة `createMultiAccountEntry` من خدمة القيود المحاسبية لإنشاء القيد الذي يضمن توازن المدين والدائن.
   - في حال نجاح العملية، يتم عرض رقم القيد المحاسبي، وإلا يتم عرض رسالة الخطأ.

بهذا المثال يتم تسجيل قيد بيع دورة رقمية مع احتساب قيمة المحاضر وخصم البائع بحيث يكون القيد متوازنًا وفق أسلوب القيد المزدوج.

*/